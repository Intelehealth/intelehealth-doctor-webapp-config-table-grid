<div class="container-fluid calendar-container" data-test-id="calendarContainer">
  <div class="row">
    <div class="col-md-12 p-0">
      <!-- Calendar Navigation -->
      <div class="calendar-nav d-flex justify-content-between align-items-center mb-3" data-test-id="calendarNav">
        <button class="btn btn-light" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate" data-test-id="btnPrev">
          <i class="fa fa-chevron-left"></i>
        </button>
        <h5 class="m-0" data-test-id="calendarViewTitle">{{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}</h5>
        <button class="btn btn-light" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate" data-test-id="btnNext">
          <i class="fa fa-chevron-right"></i>
        </button>
      </div>

      <!-- Calendar View Switch -->
      <div class="calendar-switch text-center mb-3" data-test-id="calendarViewSwitch">
        <button class="btn btn-outline-primary mr-2" (click)="view = 'day'" [class.active]="view === 'day'" data-test-id="btnDayView">Day</button>
        <button class="btn btn-outline-primary mr-2" (click)="view = 'week'" [class.active]="view === 'week'" data-test-id="btnWeekView">Week</button>
        <button class="btn btn-outline-primary" (click)="view = 'month'" [class.active]="view === 'month'" data-test-id="btnMonthView">Month</button>
      </div>

      <!-- Day View -->
      <div *ngIf="view === 'day'" class="calendar-day-view" data-test-id="dayView">
        <mwl-calendar-day-view
          [viewDate]="viewDate"
          [events]="events"
          [hourSegments]="2"
          [dayStartHour]="8"
          [dayEndHour]="20"
          [hourSegmentTemplate]="hourSegmentTemplate"
          [eventTemplate]="eventTemplate"
          data-test-id="calendarDayView"
        >
        </mwl-calendar-day-view>
      </div>

      <!-- Week View -->
      <div *ngIf="view === 'week'" class="calendar-week-view" data-test-id="weekView">
        <mwl-calendar-week-view
          [viewDate]="viewDate"
          [events]="events"
          [hourSegments]="2"
          [dayStartHour]="8"
          [dayEndHour]="20"
          [hourSegmentTemplate]="hourSegmentTemplate"
          [eventTemplate]="eventTemplate"
          data-test-id="calendarWeekView"
        >
        </mwl-calendar-week-view>
      </div>

      <!-- Month View -->
      <div *ngIf="view === 'month'" class="calendar-month-view" data-test-id="monthView">
        <mwl-calendar-month-view
          [viewDate]="viewDate"
          [events]="events"
          [cellTemplate]="cellTemplate"
          [eventTemplate]="eventTemplate"
          data-test-id="calendarMonthView"
        >
        </mwl-calendar-month-view>
      </div>
    </div>
  </div>
</div>

<!-- Event Template -->
<ng-template #eventTemplate let-event="event">
  <div class="event-item" data-test-id="calendarEventItem">
    <strong data-test-id="eventTitle">{{ event.title }}</strong>
    <div data-test-id="eventDetails">
      <span *ngIf="event.meta?.patient" data-test-id="eventPatient">ðŸ‘¤ {{ event.meta.patient }}</span><br />
      <span *ngIf="event.meta?.doctor" data-test-id="eventDoctor">ðŸ©º {{ event.meta.doctor }}</span><br />
      <span *ngIf="event.meta?.time" data-test-id="eventTime">ðŸ•’ {{ event.meta.time }}</span>
    </div>
  </div>
</ng-template>

<!-- Hour Segment Template -->
<ng-template #hourSegmentTemplate let-date="date" let-segment="segment">
  <div class="hour-segment" data-test-id="hourSegment">
    {{ date | date: 'shortTime' }}
  </div>
</ng-template>

<!-- Month Cell Template -->
<ng-template #cellTemplate let-day="day" let-locale="locale">
  <div class="cell-template" data-test-id="monthCell">
    <span class="day-number" data-test-id="monthCellDay">{{ day.date | calendarDate:'monthViewDayNumber':locale }}</span>
    <span class="day-badge" *ngIf="day.badgeTotal > 0" data-test-id="monthCellBadge">{{ day.badgeTotal }}</span>
  </div>
</ng-template>
