import { languages, visitTypes } from "../config/constant";
// import * as moment from 'moment';
import moment from 'moment';
import { DecimalPipe } from "@angular/common";
// import { environment } from "src/environments/environment";
export function getCacheData(parse, key) {
    if (parse) {
        try {
            return JSON.parse(localStorage.getItem(key));
        }
        catch (error) {
            return null;
        }
    }
    else {
        return localStorage.getItem(key);
    }
}
export function setCacheData(key, value) {
    localStorage.setItem(key, value);
}
export function deleteCacheData(key) {
    localStorage.removeItem(key);
}
export function isJsonString(str) {
    try {
        const json = JSON.parse(str);
        return (typeof json === 'object');
    }
    catch (e) {
        return false;
    }
}
export function getEncounterProviderUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).encounterProviders[0].provider.uuid;
}
export function getEncounterUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).uuid;
}
/**
  * Check how old the date is from now
  * @param {string} data - Date in string format
  * @return {string} - Returns how old the date is from now
  */
export function checkIfDateOldThanOneDay(data) {
    let hours = moment(data).diff(moment(), 'hours');
    let minutes = moment(data).diff(moment(), 'minutes');
    minutes = minutes - (hours * 60);
    let resString = "";
    if (hours >= 24) {
        resString = moment(data).format('DD MMM, YYYY hh:mm A');
    }
    else {
        if (hours > 1) {
            resString += hours + " Hours";
        }
        else if (hours === 1) {
            resString += hours + " Hour";
        }
        if (minutes < 0) {
            resString = `Due : ${moment(data).format('DD MMM, YYYY hh:mm A')}`;
        }
        else if (minutes === 1) {
            resString += " " + minutes + " Minute";
        }
        else {
            resString += " " + minutes + " Minutes";
        }
    }
    return resString.trim();
}
/**
  * Compare data for sorting
  * @param {number|string} a
  * @param {number|string} b
  * @param {boolean} isAsc
  * @return {number} - Returns order as 1 or -1
  */
export function compare(a, b, isAsc) {
    return (a < b ? -1 : 1) * (isAsc ? 1 : -1);
}
/**
* Get speciality
* @param {ProviderAttributeModel[]} attr - Array of provider attributes
* @return {string} - Speciality
*/
export function getSpecialization(attr = []) {
    let specialization = '';
    for (const a of attr) {
        if (a.attributeType.uuid == 'ed1715f5-93e2-404e-b3c9-2a2d9600f062' && !a.voided) {
            specialization = a.value;
            break;
        }
    }
    return specialization;
}
export function getFieldValueByLanguage(element) {
    const selectedLanguage = getCacheData(false, languages.SELECTED_LANGUAGE);
    // Check if selected language exists in the lang object and is not empty
    if (element?.lang?.[selectedLanguage]?.trim()) {
        return element.lang[selectedLanguage].trim();
    }
    // Return the first non-empty language value
    for (const langValue of Object.values(element?.lang || {})) {
        if (langValue.trim()) {
            return langValue.trim();
        }
    }
    // Fallback to element.name if no valid language value found or element is invalid
    return element?.name || "";
}
export function calculateBMI(vitals, vitalObs, _locale = 'en') {
    const heightUUID = vitals?.find((v) => v.key === 'height_cm')?.uuid;
    const weightUUID = vitals?.find((v) => v.key === 'weight_kg')?.uuid;
    let height = null, weight = null;
    if (heightUUID && weightUUID) {
        height = vitalObs.find((e) => e.concept.uuid === heightUUID)?.value;
        weight = vitalObs.find((e) => e.concept.uuid === weightUUID)?.value;
    }
    if (height && weight) {
        const decimalPipe = new DecimalPipe(_locale);
        return decimalPipe.transform(weight / ((height / 100) * (height / 100)), "1.2-2");
    }
    return null;
}
export function isFeaturePresent(featureLists, featureName, notInclude = false) {
    const featureList = featureLists ?? []; // Extract from ENV file
    if (notInclude)
        return !featureList.includes(featureName);
    return featureList.includes(featureName);
}
export function getCallDuration(given_seconds) {
    let dateObj = new Date(given_seconds * 1000);
    let hours = dateObj.getUTCHours();
    let minutes = dateObj.getUTCMinutes();
    let seconds = dateObj.getSeconds();
    return hours.toString().padStart(2, '0') + ':' +
        minutes.toString().padStart(2, '0') + ':' +
        seconds.toString().padStart(2, '0');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbGl0eS1mdW5jdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9paC1saWJyYXJ5L3NyYy9saWIvdXRpbHMvdXRpbGl0eS1mdW5jdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMzRCxvQ0FBb0M7QUFDcEMsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBRTVCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM5Qyw4REFBOEQ7QUFFOUQsTUFBTSxVQUFVLFlBQVksQ0FBQyxLQUFjLEVBQUUsR0FBVztJQUN0RCxJQUFJLEtBQUssRUFBRTtRQUNULElBQUk7WUFDRixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzlDO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLElBQUksQ0FBQTtTQUNaO0tBQ0Y7U0FBTTtRQUNMLE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNsQztBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLEdBQVcsRUFBRSxLQUFhO0lBQ3JELFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxNQUFNLFVBQVUsZUFBZSxDQUFDLEdBQVc7SUFDekMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUMvQixDQUFDO0FBRUQsTUFBTSxVQUFVLFlBQVksQ0FBQyxHQUFHO0lBQzlCLElBQUk7UUFDRixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxPQUFPLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQztLQUNuQztJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1YsT0FBTyxLQUFLLENBQUM7S0FDZDtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsd0JBQXdCO0lBQ3RDLE9BQU8sWUFBWSxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO0FBQ2hHLENBQUM7QUFFRCxNQUFNLFVBQVUsZ0JBQWdCO0lBQzlCLE9BQU8sWUFBWSxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDakUsQ0FBQztBQUVEOzs7O0lBSUk7QUFDSixNQUFNLFVBQVUsd0JBQXdCLENBQUMsSUFBWTtJQUNuRCxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pELElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDckQsT0FBTyxHQUFHLE9BQU8sR0FBRyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqQyxJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDbkIsSUFBSSxLQUFLLElBQUksRUFBRSxFQUFFO1FBQ2YsU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQztLQUN6RDtTQUFNO1FBQ0wsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFO1lBQ2IsU0FBUyxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUM7U0FDL0I7YUFBTSxJQUFHLEtBQUssS0FBSyxDQUFDLEVBQUU7WUFDckIsU0FBUyxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUM7U0FDOUI7UUFDRCxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUU7WUFDZixTQUFTLEdBQUcsU0FBUyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLHNCQUFzQixDQUFDLEVBQUUsQ0FBQztTQUNwRTthQUFNLElBQUksT0FBTyxLQUFLLENBQUMsRUFBQztZQUN2QixTQUFTLElBQUksR0FBRyxHQUFHLE9BQU8sR0FBRyxTQUFTLENBQUE7U0FDdkM7YUFBTTtZQUNMLFNBQVMsSUFBSSxHQUFHLEdBQUcsT0FBTyxHQUFHLFVBQVUsQ0FBQTtTQUN4QztLQUNGO0lBQ0QsT0FBTyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDMUIsQ0FBQztBQUNEOzs7Ozs7SUFNSTtBQUNKLE1BQU0sVUFBVSxPQUFPLENBQUMsQ0FBa0IsRUFBRSxDQUFrQixFQUFFLEtBQWM7SUFDNUUsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzdDLENBQUM7QUFFRDs7OztFQUlFO0FBQ0YsTUFBTSxVQUFVLGlCQUFpQixDQUFDLE9BQWlDLEVBQUU7SUFDbkUsSUFBSSxjQUFjLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLEtBQUssTUFBTSxDQUFDLElBQUksSUFBSSxFQUFFO1FBQ3BCLElBQUksQ0FBQyxDQUFDLGFBQWEsQ0FBQyxJQUFJLElBQUksc0NBQXNDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFO1lBQy9FLGNBQWMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ3pCLE1BQU07U0FDUDtLQUNGO0lBQ0QsT0FBTyxjQUFjLENBQUM7QUFDeEIsQ0FBQztBQWlCRCxNQUFNLFVBQVUsdUJBQXVCLENBQUMsT0FBbUM7SUFDekUsTUFBTSxnQkFBZ0IsR0FBRyxZQUFZLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBVyxDQUFDO0lBRXBGLHdFQUF3RTtJQUN4RSxJQUFJLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFO1FBQzdDLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0tBQzlDO0lBRUQsNENBQTRDO0lBQzVDLEtBQUssTUFBTSxTQUFTLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxFQUFFO1FBQzFELElBQUksU0FBUyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3BCLE9BQU8sU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO1NBQ3pCO0tBQ0Y7SUFFRCxrRkFBa0Y7SUFDbEYsT0FBTyxPQUFPLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQztBQUM3QixDQUFDO0FBRUQsTUFBTSxVQUFVLFlBQVksQ0FBQyxNQUFXLEVBQUUsUUFBYSxFQUFFLFVBQWtCLElBQUk7SUFDN0UsTUFBTSxVQUFVLEdBQUcsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxXQUFXLENBQUMsRUFBRSxJQUFJLENBQUM7SUFDekUsTUFBTSxVQUFVLEdBQUcsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxXQUFXLENBQUMsRUFBRSxJQUFJLENBQUM7SUFDekUsSUFBSSxNQUFNLEdBQUcsSUFBSSxFQUFFLE1BQU0sR0FBRyxJQUFJLENBQUM7SUFDakMsSUFBRyxVQUFVLElBQUksVUFBVSxFQUFFO1FBQzNCLE1BQU0sR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBK0IsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssVUFBVSxDQUFDLEVBQUUsS0FBSyxDQUFDO1FBQ2xHLE1BQU0sR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBK0IsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssVUFBVSxDQUFDLEVBQUUsS0FBSyxDQUFDO0tBQ25HO0lBQ0QsSUFBRyxNQUFNLElBQUksTUFBTSxFQUFFO1FBQ25CLE1BQU0sV0FBVyxHQUFHLElBQUksV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQzVDLE9BQU8sV0FBVyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLE1BQU0sR0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0tBQzlFO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQsTUFBTSxVQUFVLGdCQUFnQixDQUFDLFlBQW9CLEVBQUUsV0FBbUIsRUFBRSxVQUFVLEdBQUcsS0FBSztJQUM1RixNQUFNLFdBQVcsR0FBRyxZQUFZLElBQUksRUFBRSxDQUFDLENBQUMsd0JBQXdCO0lBQ2hFLElBQUcsVUFBVTtRQUFFLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3pELE9BQU8sV0FBVyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUMzQyxDQUFDO0FBRUQsTUFBTSxVQUFVLGVBQWUsQ0FBQyxhQUFxQjtJQUNuRCxJQUFJLE9BQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDN0MsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ2xDLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN0QyxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDbkMsT0FBTyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHO1FBQzFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUc7UUFDekMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDMUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGxhbmd1YWdlcywgdmlzaXRUeXBlcyB9IGZyb20gXCIuLi9jb25maWcvY29uc3RhbnRcIjtcclxuLy8gaW1wb3J0ICogYXMgbW9tZW50IGZyb20gJ21vbWVudCc7XHJcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcclxuaW1wb3J0IHsgUHJvdmlkZXJBdHRyaWJ1dGVNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9tb2RlbFwiO1xyXG5pbXBvcnQgeyBEZWNpbWFsUGlwZSB9IGZyb20gXCJAYW5ndWxhci9jb21tb25cIjtcclxuLy8gaW1wb3J0IHsgZW52aXJvbm1lbnQgfSBmcm9tIFwic3JjL2Vudmlyb25tZW50cy9lbnZpcm9ubWVudFwiO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENhY2hlRGF0YShwYXJzZTogYm9vbGVhbiwga2V5OiBzdHJpbmcpIHtcclxuICBpZiAocGFyc2UpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0Q2FjaGVEYXRhKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XHJcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVDYWNoZURhdGEoa2V5OiBzdHJpbmcpIHtcclxuICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNKc29uU3RyaW5nKHN0cikge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHIpO1xyXG4gICAgcmV0dXJuICh0eXBlb2YganNvbiA9PT0gJ29iamVjdCcpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbmNvdW50ZXJQcm92aWRlclVVSUQoKSB7XHJcbiAgcmV0dXJuIGdldENhY2hlRGF0YSh0cnVlLCB2aXNpdFR5cGVzLlZJU0lUX05PVEVfUFJPVklERVIpLmVuY291bnRlclByb3ZpZGVyc1swXS5wcm92aWRlci51dWlkO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW5jb3VudGVyVVVJRCgpIHtcclxuICByZXR1cm4gZ2V0Q2FjaGVEYXRhKHRydWUsIHZpc2l0VHlwZXMuVklTSVRfTk9URV9QUk9WSURFUikudXVpZDtcclxufVxyXG5cclxuLyoqXHJcbiAgKiBDaGVjayBob3cgb2xkIHRoZSBkYXRlIGlzIGZyb20gbm93XHJcbiAgKiBAcGFyYW0ge3N0cmluZ30gZGF0YSAtIERhdGUgaW4gc3RyaW5nIGZvcm1hdFxyXG4gICogQHJldHVybiB7c3RyaW5nfSAtIFJldHVybnMgaG93IG9sZCB0aGUgZGF0ZSBpcyBmcm9tIG5vd1xyXG4gICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjaGVja0lmRGF0ZU9sZFRoYW5PbmVEYXkoZGF0YTogc3RyaW5nKSB7XHJcbiAgbGV0IGhvdXJzID0gbW9tZW50KGRhdGEpLmRpZmYobW9tZW50KCksICdob3VycycpO1xyXG4gIGxldCBtaW51dGVzID0gbW9tZW50KGRhdGEpLmRpZmYobW9tZW50KCksICdtaW51dGVzJyk7XHJcbiAgbWludXRlcyA9IG1pbnV0ZXMgLSAoaG91cnMgKiA2MCk7XHJcbiAgbGV0IHJlc1N0cmluZyA9IFwiXCI7XHJcbiAgaWYgKGhvdXJzID49IDI0KSB7XHJcbiAgICByZXNTdHJpbmcgPSBtb21lbnQoZGF0YSkuZm9ybWF0KCdERCBNTU0sIFlZWVkgaGg6bW0gQScpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAoaG91cnMgPiAxKSB7XHJcbiAgICAgIHJlc1N0cmluZyArPSBob3VycyArIFwiIEhvdXJzXCI7XHJcbiAgICB9IGVsc2UgaWYoaG91cnMgPT09IDEpIHtcclxuICAgICAgcmVzU3RyaW5nICs9IGhvdXJzICsgXCIgSG91clwiO1xyXG4gICAgfVxyXG4gICAgaWYgKG1pbnV0ZXMgPCAwKSB7XHJcbiAgICAgIHJlc1N0cmluZyA9IGBEdWUgOiAke21vbWVudChkYXRhKS5mb3JtYXQoJ0REIE1NTSwgWVlZWSBoaDptbSBBJyl9YDtcclxuICAgIH0gZWxzZSBpZiAobWludXRlcyA9PT0gMSl7XHJcbiAgICAgIHJlc1N0cmluZyArPSBcIiBcIiArIG1pbnV0ZXMgKyBcIiBNaW51dGVcIlxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzU3RyaW5nICs9IFwiIFwiICsgbWludXRlcyArIFwiIE1pbnV0ZXNcIlxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gcmVzU3RyaW5nLnRyaW0oKTtcclxufVxyXG4vKipcclxuICAqIENvbXBhcmUgZGF0YSBmb3Igc29ydGluZ1xyXG4gICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBhXHJcbiAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGJcclxuICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNBc2NcclxuICAqIEByZXR1cm4ge251bWJlcn0gLSBSZXR1cm5zIG9yZGVyIGFzIDEgb3IgLTFcclxuICAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZShhOiBudW1iZXIgfCBzdHJpbmcsIGI6IG51bWJlciB8IHN0cmluZywgaXNBc2M6IGJvb2xlYW4pIHtcclxuICByZXR1cm4gKGEgPCBiID8gLTEgOiAxKSAqIChpc0FzYyA/IDEgOiAtMSk7XHJcbn1cclxuXHJcbi8qKlxyXG4qIEdldCBzcGVjaWFsaXR5XHJcbiogQHBhcmFtIHtQcm92aWRlckF0dHJpYnV0ZU1vZGVsW119IGF0dHIgLSBBcnJheSBvZiBwcm92aWRlciBhdHRyaWJ1dGVzXHJcbiogQHJldHVybiB7c3RyaW5nfSAtIFNwZWNpYWxpdHlcclxuKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFNwZWNpYWxpemF0aW9uKGF0dHI6IFByb3ZpZGVyQXR0cmlidXRlTW9kZWxbXSA9IFtdKTogc3RyaW5nIHtcclxuICBsZXQgc3BlY2lhbGl6YXRpb24gPSAnJztcclxuICBmb3IgKGNvbnN0IGEgb2YgYXR0cikge1xyXG4gICAgaWYgKGEuYXR0cmlidXRlVHlwZS51dWlkID09ICdlZDE3MTVmNS05M2UyLTQwNGUtYjNjOS0yYTJkOTYwMGYwNjInICYmICFhLnZvaWRlZCkge1xyXG4gICAgICBzcGVjaWFsaXphdGlvbiA9IGEudmFsdWU7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gc3BlY2lhbGl6YXRpb247XHJcbn1cclxuXHJcbi8qKlxyXG4qIFJldHJpZXZlIHRoZSBhcHByb3ByaWF0ZSBsYW5ndWFnZSB2YWx1ZSBmcm9tIGFuIGVsZW1lbnQuXHJcbiogQHBhcmFtIHthbnl9IGVsZW1lbnQgLSBBbiBvYmplY3QgY29udGFpbmluZyBgbGFuZ2AgYW5kIGBuYW1lYC5cclxuKiBAcmV0dXJuIHtzdHJpbmd9IC0gVGhlIHZhbHVlIGluIHRoZSBzZWxlY3RlZCBsYW5ndWFnZSBvciB0aGUgZmlyc3QgYXZhaWxhYmxlIG9uZS5cclxuKiBEZWZhdWx0cyB0byBgZWxlbWVudC5uYW1lYCBpZiBubyBsYW5ndWFnZSB2YWx1ZSBpcyBmb3VuZC5cclxuKi9cclxuaW50ZXJmYWNlIEVsZW1lbnRMYW5nIHtcclxuICBba2V5OiBzdHJpbmddOiBzdHJpbmc7IC8vIFJlcHJlc2VudHMgbGFuZ3VhZ2UgY29kZSB0byBzdHJpbmcgbWFwcGluZ3NcclxufVxyXG5cclxuaW50ZXJmYWNlIEVsZW1lbnQge1xyXG4gIGxhbmc6IEVsZW1lbnRMYW5nO1xyXG4gIG5hbWU6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpZWxkVmFsdWVCeUxhbmd1YWdlKGVsZW1lbnQ6IEVsZW1lbnQgfCBudWxsIHwgdW5kZWZpbmVkKTogc3RyaW5nIHtcclxuICBjb25zdCBzZWxlY3RlZExhbmd1YWdlID0gZ2V0Q2FjaGVEYXRhKGZhbHNlLCBsYW5ndWFnZXMuU0VMRUNURURfTEFOR1VBR0UpIGFzIHN0cmluZztcclxuXHJcbiAgLy8gQ2hlY2sgaWYgc2VsZWN0ZWQgbGFuZ3VhZ2UgZXhpc3RzIGluIHRoZSBsYW5nIG9iamVjdCBhbmQgaXMgbm90IGVtcHR5XHJcbiAgaWYgKGVsZW1lbnQ/Lmxhbmc/LltzZWxlY3RlZExhbmd1YWdlXT8udHJpbSgpKSB7XHJcbiAgICByZXR1cm4gZWxlbWVudC5sYW5nW3NlbGVjdGVkTGFuZ3VhZ2VdLnRyaW0oKTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybiB0aGUgZmlyc3Qgbm9uLWVtcHR5IGxhbmd1YWdlIHZhbHVlXHJcbiAgZm9yIChjb25zdCBsYW5nVmFsdWUgb2YgT2JqZWN0LnZhbHVlcyhlbGVtZW50Py5sYW5nIHx8IHt9KSkge1xyXG4gICAgaWYgKGxhbmdWYWx1ZS50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIGxhbmdWYWx1ZS50cmltKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBGYWxsYmFjayB0byBlbGVtZW50Lm5hbWUgaWYgbm8gdmFsaWQgbGFuZ3VhZ2UgdmFsdWUgZm91bmQgb3IgZWxlbWVudCBpcyBpbnZhbGlkXHJcbiAgcmV0dXJuIGVsZW1lbnQ/Lm5hbWUgfHwgXCJcIjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUJNSSh2aXRhbHM6IGFueSwgdml0YWxPYnM6IGFueSwgX2xvY2FsZTogc3RyaW5nID0gJ2VuJykge1xyXG4gIGNvbnN0IGhlaWdodFVVSUQgPSB2aXRhbHM/LmZpbmQoKHY6IGFueSkgPT4gdi5rZXkgPT09ICdoZWlnaHRfY20nKT8udXVpZDtcclxuICBjb25zdCB3ZWlnaHRVVUlEID0gdml0YWxzPy5maW5kKCh2OiBhbnkpID0+IHYua2V5ID09PSAnd2VpZ2h0X2tnJyk/LnV1aWQ7XHJcbiAgbGV0IGhlaWdodCA9IG51bGwsIHdlaWdodCA9IG51bGw7XHJcbiAgaWYoaGVpZ2h0VVVJRCAmJiB3ZWlnaHRVVUlEKSB7XHJcbiAgICBoZWlnaHQgPSB2aXRhbE9icy5maW5kKChlOiB7IGNvbmNlcHQ6IHsgdXVpZDogYW55OyB9OyB9KSA9PiBlLmNvbmNlcHQudXVpZCA9PT0gaGVpZ2h0VVVJRCk/LnZhbHVlO1xyXG4gICAgd2VpZ2h0ID0gdml0YWxPYnMuZmluZCgoZTogeyBjb25jZXB0OiB7IHV1aWQ6IGFueTsgfTsgfSkgPT4gZS5jb25jZXB0LnV1aWQgPT09IHdlaWdodFVVSUQpPy52YWx1ZTtcclxuICB9XHJcbiAgaWYoaGVpZ2h0ICYmIHdlaWdodCkge1xyXG4gICAgY29uc3QgZGVjaW1hbFBpcGUgPSBuZXcgRGVjaW1hbFBpcGUoX2xvY2FsZSlcclxuICAgIHJldHVybiBkZWNpbWFsUGlwZS50cmFuc2Zvcm0od2VpZ2h0IC8gKChoZWlnaHQvMTAwKSAqIChoZWlnaHQvMTAwKSksIFwiMS4yLTJcIilcclxuICB9ICBcclxuICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzRmVhdHVyZVByZXNlbnQoZmVhdHVyZUxpc3RzOiBzdHJpbmcsIGZlYXR1cmVOYW1lOiBzdHJpbmcsIG5vdEluY2x1ZGUgPSBmYWxzZSk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IGZlYXR1cmVMaXN0ID0gZmVhdHVyZUxpc3RzID8/IFtdOyAvLyBFeHRyYWN0IGZyb20gRU5WIGZpbGVcclxuICBpZihub3RJbmNsdWRlKSByZXR1cm4gIWZlYXR1cmVMaXN0LmluY2x1ZGVzKGZlYXR1cmVOYW1lKTtcclxuICByZXR1cm4gZmVhdHVyZUxpc3QuaW5jbHVkZXMoZmVhdHVyZU5hbWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FsbER1cmF0aW9uKGdpdmVuX3NlY29uZHM6IG51bWJlcil7XHJcbiAgbGV0IGRhdGVPYmogPSBuZXcgRGF0ZShnaXZlbl9zZWNvbmRzICogMTAwMCk7XHJcbiAgbGV0IGhvdXJzID0gZGF0ZU9iai5nZXRVVENIb3VycygpO1xyXG4gIGxldCBtaW51dGVzID0gZGF0ZU9iai5nZXRVVENNaW51dGVzKCk7XHJcbiAgbGV0IHNlY29uZHMgPSBkYXRlT2JqLmdldFNlY29uZHMoKTtcclxuICByZXR1cm4gaG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJzonICsgXHJcbiAgICAgIG1pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJzonICsgXHJcbiAgICAgIHNlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xyXG59Il19