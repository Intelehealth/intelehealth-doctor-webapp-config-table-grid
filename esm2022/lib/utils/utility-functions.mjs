import { languages, visitTypes } from "../config/constant";
// import * as moment from 'moment';
import moment from 'moment';
import { DecimalPipe } from "@angular/common";
// import { environment } from "src/environments/environment";
export function getCacheData(parse, key) {
    if (parse) {
        try {
            return JSON.parse(localStorage.getItem(key));
        }
        catch (error) {
            return null;
        }
    }
    else {
        return localStorage.getItem(key);
    }
}
export function setCacheData(key, value) {
    localStorage.setItem(key, value);
}
export function deleteCacheData(key) {
    localStorage.removeItem(key);
}
export function isJsonString(str) {
    try {
        const json = JSON.parse(str);
        return (typeof json === 'object');
    }
    catch (e) {
        return false;
    }
}
export function getEncounterProviderUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).encounterProviders[0].provider.uuid;
}
export function getEncounterUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).uuid;
}
/**
  * Check how old the date is from now
  * @param {string} data - Date in string format
  * @return {string} - Returns how old the date is from now
  */
export function checkIfDateOldThanOneDay(data) {
    let hours = moment(data).diff(moment(), 'hours');
    let minutes = moment(data).diff(moment(), 'minutes');
    minutes = minutes - (hours * 60);
    let resString = "";
    if (hours >= 24) {
        resString = moment(data).format('DD MMM, YYYY hh:mm A');
    }
    else {
        if (hours > 1) {
            resString += hours + " Hours";
        }
        else if (hours === 1) {
            resString += hours + " Hour";
        }
        if (minutes < 0) {
            resString = `Due : ${moment(data).format('DD MMM, YYYY hh:mm A')}`;
        }
        else if (minutes === 1) {
            resString += " " + minutes + " Minute";
        }
        else {
            resString += " " + minutes + " Minutes";
        }
    }
    return resString.trim();
}
/**
  * Compare data for sorting
  * @param {number|string} a
  * @param {number|string} b
  * @param {boolean} isAsc
  * @return {number} - Returns order as 1 or -1
  */
export function compare(a, b, isAsc) {
    return (a < b ? -1 : 1) * (isAsc ? 1 : -1);
}
/**
* Get speciality
* @param {ProviderAttributeModel[]} attr - Array of provider attributes
* @return {string} - Speciality
*/
export function getSpecialization(attr = []) {
    let specialization = '';
    for (const a of attr) {
        if (a.attributeType.uuid == 'ed1715f5-93e2-404e-b3c9-2a2d9600f062' && !a.voided) {
            specialization = a.value;
            break;
        }
    }
    return specialization;
}
export function getFieldValueByLanguage(element) {
    const selectedLanguage = getCacheData(false, languages.SELECTED_LANGUAGE);
    // Check if selected language exists in the lang object and is not empty
    if (element?.lang?.[selectedLanguage]?.trim()) {
        return element.lang[selectedLanguage].trim();
    }
    // Return the first non-empty language value
    for (const langValue of Object.values(element?.lang || {})) {
        if (langValue.trim()) {
            return langValue.trim();
        }
    }
    // Fallback to element.name if no valid language value found or element is invalid
    return element?.name || "";
}
export function calculateBMI(vitals, vitalObs, _locale = 'en') {
    const heightUUID = vitals?.find((v) => v.key === 'height_cm')?.uuid;
    const weightUUID = vitals?.find((v) => v.key === 'weight_kg')?.uuid;
    let height = null, weight = null;
    if (heightUUID && weightUUID) {
        height = vitalObs.find((e) => e.concept.uuid === heightUUID)?.value;
        weight = vitalObs.find((e) => e.concept.uuid === weightUUID)?.value;
    }
    if (height && weight) {
        const decimalPipe = new DecimalPipe(_locale);
        return decimalPipe.transform(weight / ((height / 100) * (height / 100)), "1.2-2");
    }
    return null;
}
export function isFeaturePresent(featureLists, featureName, notInclude = false) {
    const featureList = featureLists ?? []; // Extract from ENV file
    if (notInclude)
        return !featureList.includes(featureName);
    return featureList.includes(featureName);
}
export function getCallDuration(given_seconds) {
    let dateObj = new Date(given_seconds * 1000);
    let hours = dateObj.getUTCHours();
    let minutes = dateObj.getUTCMinutes();
    let seconds = dateObj.getSeconds();
    return hours.toString().padStart(2, '0') + ':' +
        minutes.toString().padStart(2, '0') + ':' +
        seconds.toString().padStart(2, '0');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbGl0eS1mdW5jdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9paC1saWJyYXJ5L3NyYy9saWIvdXRpbHMvdXRpbGl0eS1mdW5jdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMzRCxvQ0FBb0M7QUFDcEMsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBRTVCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM5Qyw4REFBOEQ7QUFFOUQsTUFBTSxVQUFVLFlBQVksQ0FBQyxLQUFjLEVBQUUsR0FBVztJQUN0RCxJQUFJLEtBQUssRUFBRTtRQUNULElBQUk7WUFDRixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzlDO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLElBQUksQ0FBQTtTQUNaO0tBQ0Y7U0FBTTtRQUNMLE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNsQztBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLEdBQVcsRUFBRSxLQUFhO0lBQ3JELFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxNQUFNLFVBQVUsZUFBZSxDQUFDLEdBQVc7SUFDekMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUMvQixDQUFDO0FBRUQsTUFBTSxVQUFVLFlBQVksQ0FBQyxHQUFHO0lBQzlCLElBQUk7UUFDRixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxPQUFPLElBQUksS0FBSyxRQUFRLENB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QUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUc7UUFDekMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDMUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGxhbmd1YWdlcywgdmlzaXRUeXBlcyB9IGZyb20gXCIuLi9jb25maWcvY29uc3RhbnRcIjtcbi8vIGltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgUHJvdmlkZXJBdHRyaWJ1dGVNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9tb2RlbFwiO1xuaW1wb3J0IHsgRGVjaW1hbFBpcGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uXCI7XG4vLyBpbXBvcnQgeyBlbnZpcm9ubWVudCB9IGZyb20gXCJzcmMvZW52aXJvbm1lbnRzL2Vudmlyb25tZW50XCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDYWNoZURhdGEocGFyc2U6IGJvb2xlYW4sIGtleTogc3RyaW5nKSB7XG4gIGlmIChwYXJzZSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldENhY2hlRGF0YShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhY2hlRGF0YShrZXk6IHN0cmluZykge1xuICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNKc29uU3RyaW5nKHN0cikge1xuICB0cnkge1xuICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0cik7XG4gICAgcmV0dXJuICh0eXBlb2YganNvbiA9PT0gJ29iamVjdCcpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbmNvdW50ZXJQcm92aWRlclVVSUQoKSB7XG4gIHJldHVybiBnZXRDYWNoZURhdGEodHJ1ZSwgdmlzaXRUeXBlcy5WSVNJVF9OT1RFX1BST1ZJREVSKS5lbmNvdW50ZXJQcm92aWRlcnNbMF0ucHJvdmlkZXIudXVpZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVuY291bnRlclVVSUQoKSB7XG4gIHJldHVybiBnZXRDYWNoZURhdGEodHJ1ZSwgdmlzaXRUeXBlcy5WSVNJVF9OT1RFX1BST1ZJREVSKS51dWlkO1xufVxuXG4vKipcbiAgKiBDaGVjayBob3cgb2xkIHRoZSBkYXRlIGlzIGZyb20gbm93XG4gICogQHBhcmFtIHtzdHJpbmd9IGRhdGEgLSBEYXRlIGluIHN0cmluZyBmb3JtYXRcbiAgKiBAcmV0dXJuIHtzdHJpbmd9IC0gUmV0dXJucyBob3cgb2xkIHRoZSBkYXRlIGlzIGZyb20gbm93XG4gICovXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tJZkRhdGVPbGRUaGFuT25lRGF5KGRhdGE6IHN0cmluZykge1xuICBsZXQgaG91cnMgPSBtb21lbnQoZGF0YSkuZGlmZihtb21lbnQoKSwgJ2hvdXJzJyk7XG4gIGxldCBtaW51dGVzID0gbW9tZW50KGRhdGEpLmRpZmYobW9tZW50KCksICdtaW51dGVzJyk7XG4gIG1pbnV0ZXMgPSBtaW51dGVzIC0gKGhvdXJzICogNjApO1xuICBsZXQgcmVzU3RyaW5nID0gXCJcIjtcbiAgaWYgKGhvdXJzID49IDI0KSB7XG4gICAgcmVzU3RyaW5nID0gbW9tZW50KGRhdGEpLmZvcm1hdCgnREQgTU1NLCBZWVlZIGhoOm1tIEEnKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoaG91cnMgPiAxKSB7XG4gICAgICByZXNTdHJpbmcgKz0gaG91cnMgKyBcIiBIb3Vyc1wiO1xuICAgIH0gZWxzZSBpZihob3VycyA9PT0gMSkge1xuICAgICAgcmVzU3RyaW5nICs9IGhvdXJzICsgXCIgSG91clwiO1xuICAgIH1cbiAgICBpZiAobWludXRlcyA8IDApIHtcbiAgICAgIHJlc1N0cmluZyA9IGBEdWUgOiAke21vbWVudChkYXRhKS5mb3JtYXQoJ0REIE1NTSwgWVlZWSBoaDptbSBBJyl9YDtcbiAgICB9IGVsc2UgaWYgKG1pbnV0ZXMgPT09IDEpe1xuICAgICAgcmVzU3RyaW5nICs9IFwiIFwiICsgbWludXRlcyArIFwiIE1pbnV0ZVwiXG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc1N0cmluZyArPSBcIiBcIiArIG1pbnV0ZXMgKyBcIiBNaW51dGVzXCJcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc1N0cmluZy50cmltKCk7XG59XG4vKipcbiAgKiBDb21wYXJlIGRhdGEgZm9yIHNvcnRpbmdcbiAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGFcbiAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGJcbiAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzQXNjXG4gICogQHJldHVybiB7bnVtYmVyfSAtIFJldHVybnMgb3JkZXIgYXMgMSBvciAtMVxuICAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmUoYTogbnVtYmVyIHwgc3RyaW5nLCBiOiBudW1iZXIgfCBzdHJpbmcsIGlzQXNjOiBib29sZWFuKSB7XG4gIHJldHVybiAoYSA8IGIgPyAtMSA6IDEpICogKGlzQXNjID8gMSA6IC0xKTtcbn1cblxuLyoqXG4qIEdldCBzcGVjaWFsaXR5XG4qIEBwYXJhbSB7UHJvdmlkZXJBdHRyaWJ1dGVNb2RlbFtdfSBhdHRyIC0gQXJyYXkgb2YgcHJvdmlkZXIgYXR0cmlidXRlc1xuKiBAcmV0dXJuIHtzdHJpbmd9IC0gU3BlY2lhbGl0eVxuKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTcGVjaWFsaXphdGlvbihhdHRyOiBQcm92aWRlckF0dHJpYnV0ZU1vZGVsW10gPSBbXSk6IHN0cmluZyB7XG4gIGxldCBzcGVjaWFsaXphdGlvbiA9ICcnO1xuICBmb3IgKGNvbnN0IGEgb2YgYXR0cikge1xuICAgIGlmIChhLmF0dHJpYnV0ZVR5cGUudXVpZCA9PSAnZWQxNzE1ZjUtOTNlMi00MDRlLWIzYzktMmEyZDk2MDBmMDYyJyAmJiAhYS52b2lkZWQpIHtcbiAgICAgIHNwZWNpYWxpemF0aW9uID0gYS52YWx1ZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gc3BlY2lhbGl6YXRpb247XG59XG5cbi8qKlxuKiBSZXRyaWV2ZSB0aGUgYXBwcm9wcmlhdGUgbGFuZ3VhZ2UgdmFsdWUgZnJvbSBhbiBlbGVtZW50LlxuKiBAcGFyYW0ge2FueX0gZWxlbWVudCAtIEFuIG9iamVjdCBjb250YWluaW5nIGBsYW5nYCBhbmQgYG5hbWVgLlxuKiBAcmV0dXJuIHtzdHJpbmd9IC0gVGhlIHZhbHVlIGluIHRoZSBzZWxlY3RlZCBsYW5ndWFnZSBvciB0aGUgZmlyc3QgYXZhaWxhYmxlIG9uZS5cbiogRGVmYXVsdHMgdG8gYGVsZW1lbnQubmFtZWAgaWYgbm8gbGFuZ3VhZ2UgdmFsdWUgaXMgZm91bmQuXG4qL1xuaW50ZXJmYWNlIEVsZW1lbnRMYW5nIHtcbiAgW2tleTogc3RyaW5nXTogc3RyaW5nOyAvLyBSZXByZXNlbnRzIGxhbmd1YWdlIGNvZGUgdG8gc3RyaW5nIG1hcHBpbmdzXG59XG5cbmludGVyZmFjZSBFbGVtZW50IHtcbiAgbGFuZzogRWxlbWVudExhbmc7XG4gIG5hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpZWxkVmFsdWVCeUxhbmd1YWdlKGVsZW1lbnQ6IEVsZW1lbnQgfCBudWxsIHwgdW5kZWZpbmVkKTogc3RyaW5nIHtcbiAgY29uc3Qgc2VsZWN0ZWRMYW5ndWFnZSA9IGdldENhY2hlRGF0YShmYWxzZSwgbGFuZ3VhZ2VzLlNFTEVDVEVEX0xBTkdVQUdFKSBhcyBzdHJpbmc7XG5cbiAgLy8gQ2hlY2sgaWYgc2VsZWN0ZWQgbGFuZ3VhZ2UgZXhpc3RzIGluIHRoZSBsYW5nIG9iamVjdCBhbmQgaXMgbm90IGVtcHR5XG4gIGlmIChlbGVtZW50Py5sYW5nPy5bc2VsZWN0ZWRMYW5ndWFnZV0/LnRyaW0oKSkge1xuICAgIHJldHVybiBlbGVtZW50Lmxhbmdbc2VsZWN0ZWRMYW5ndWFnZV0udHJpbSgpO1xuICB9XG5cbiAgLy8gUmV0dXJuIHRoZSBmaXJzdCBub24tZW1wdHkgbGFuZ3VhZ2UgdmFsdWVcbiAgZm9yIChjb25zdCBsYW5nVmFsdWUgb2YgT2JqZWN0LnZhbHVlcyhlbGVtZW50Py5sYW5nIHx8IHt9KSkge1xuICAgIGlmIChsYW5nVmFsdWUudHJpbSgpKSB7XG4gICAgICByZXR1cm4gbGFuZ1ZhbHVlLnRyaW0oKTtcbiAgICB9XG4gIH1cblxuICAvLyBGYWxsYmFjayB0byBlbGVtZW50Lm5hbWUgaWYgbm8gdmFsaWQgbGFuZ3VhZ2UgdmFsdWUgZm91bmQgb3IgZWxlbWVudCBpcyBpbnZhbGlkXG4gIHJldHVybiBlbGVtZW50Py5uYW1lIHx8IFwiXCI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVCTUkodml0YWxzOiBhbnksIHZpdGFsT2JzOiBhbnksIF9sb2NhbGU6IHN0cmluZyA9ICdlbicpIHtcbiAgY29uc3QgaGVpZ2h0VVVJRCA9IHZpdGFscz8uZmluZCgodjogYW55KSA9PiB2LmtleSA9PT0gJ2hlaWdodF9jbScpPy51dWlkO1xuICBjb25zdCB3ZWlnaHRVVUlEID0gdml0YWxzPy5maW5kKCh2OiBhbnkpID0+IHYua2V5ID09PSAnd2VpZ2h0X2tnJyk/LnV1aWQ7XG4gIGxldCBoZWlnaHQgPSBudWxsLCB3ZWlnaHQgPSBudWxsO1xuICBpZihoZWlnaHRVVUlEICYmIHdlaWdodFVVSUQpIHtcbiAgICBoZWlnaHQgPSB2aXRhbE9icy5maW5kKChlOiB7IGNvbmNlcHQ6IHsgdXVpZDogYW55OyB9OyB9KSA9PiBlLmNvbmNlcHQudXVpZCA9PT0gaGVpZ2h0VVVJRCk/LnZhbHVlO1xuICAgIHdlaWdodCA9IHZpdGFsT2JzLmZpbmQoKGU6IHsgY29uY2VwdDogeyB1dWlkOiBhbnk7IH07IH0pID0+IGUuY29uY2VwdC51dWlkID09PSB3ZWlnaHRVVUlEKT8udmFsdWU7XG4gIH1cbiAgaWYoaGVpZ2h0ICYmIHdlaWdodCkge1xuICAgIGNvbnN0IGRlY2ltYWxQaXBlID0gbmV3IERlY2ltYWxQaXBlKF9sb2NhbGUpXG4gICAgcmV0dXJuIGRlY2ltYWxQaXBlLnRyYW5zZm9ybSh3ZWlnaHQgLyAoKGhlaWdodC8xMDApICogKGhlaWdodC8xMDApKSwgXCIxLjItMlwiKVxuICB9ICBcbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0ZlYXR1cmVQcmVzZW50KGZlYXR1cmVMaXN0czogc3RyaW5nLCBmZWF0dXJlTmFtZTogc3RyaW5nLCBub3RJbmNsdWRlID0gZmFsc2UpOiBib29sZWFuIHtcbiAgY29uc3QgZmVhdHVyZUxpc3QgPSBmZWF0dXJlTGlzdHMgPz8gW107IC8vIEV4dHJhY3QgZnJvbSBFTlYgZmlsZVxuICBpZihub3RJbmNsdWRlKSByZXR1cm4gIWZlYXR1cmVMaXN0LmluY2x1ZGVzKGZlYXR1cmVOYW1lKTtcbiAgcmV0dXJuIGZlYXR1cmVMaXN0LmluY2x1ZGVzKGZlYXR1cmVOYW1lKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENhbGxEdXJhdGlvbihnaXZlbl9zZWNvbmRzOiBudW1iZXIpe1xuICBsZXQgZGF0ZU9iaiA9IG5ldyBEYXRlKGdpdmVuX3NlY29uZHMgKiAxMDAwKTtcbiAgbGV0IGhvdXJzID0gZGF0ZU9iai5nZXRVVENIb3VycygpO1xuICBsZXQgbWludXRlcyA9IGRhdGVPYmouZ2V0VVRDTWludXRlcygpO1xuICBsZXQgc2Vjb25kcyA9IGRhdGVPYmouZ2V0U2Vjb25kcygpO1xuICByZXR1cm4gaG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJzonICsgXG4gICAgICBtaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICc6JyArIFxuICAgICAgc2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG59Il19